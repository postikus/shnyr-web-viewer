<!DOCTYPE html>
<html>
<head>
	<title>OCR Results</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<div class="container">
	<div class="header">
		<div class="header-content">
			<div class="title-section">
				<h1>üëì –®–ù–´–†–¨ v0.2</h1>
			</div>
			<div class="status-section">
				<div class="status-info">
					<span class="status-label">–°—Ç–∞—Ç—É—Å:</span>
					<span class="status-value" id="status-value">{{formatStatus .Status.CurrentStatus}}</span>
					<span class="status-time" id="status-time">{{if .Status.UpdatedAt}}({{formatDateTime .Status.UpdatedAt}}){{end}}</span>
				</div>
				<div class="control-buttons">
					<button class="control-btn start-btn" onclick="sendAction('start')">üöÄ Start</button>
					<button class="control-btn stop-btn" onclick="sendAction('stop')">üõë Stop</button>
					<button class="control-btn restart-btn" onclick="sendAction('restart')">üîÑ Restart</button>
				</div>
			</div>
		</div>
		
		<div class="tabs">
			<a href="/?tab=main" class="tab {{if eq .ActiveTab "main"}}active{{end}}">üè† –ì–ª–∞–≤–Ω–∞—è</a>
			<a href="/?tab=item_search" class="tab {{if eq .ActiveTab "item_search"}}active{{end}}">üîç –ü–æ–∏—Å–∫ –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É</a>
		</div>
	</div>
	
	<div class="content">
		{{if eq .ActiveTab "item_search"}}
			{{template "item_search.html" .}}
		{{else}}
			{{template "main_tab.html" .}}
		{{end}}
	</div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
{{template "modals.html" .}}

<script src="/static/js/app.js"></script>
<script>
function sendAction(action) {
	console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ:', action);
	
	fetch('/' + action, {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json',
		}
	})
	.then(response => {
		if (response.ok) {
			console.log('–î–µ–π—Å—Ç–≤–∏–µ', action, '—É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
			// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
			setTimeout(() => {
				updateStatus();
			}, 1000);
		} else {
			console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–µ–π—Å—Ç–≤–∏—è:', response.status);
			alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–µ–π—Å—Ç–≤–∏—è: ' + response.status);
		}
	})
	.catch(error => {
		console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
		alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–µ–π—Å—Ç–≤–∏—è');
	});
}

function formatStatus(status) {
	if (status === 'stop') {
		return '–°–¢–†–ê–î–ê–ï–¢ –•–£–ô–ù–ï–ô';
	} else if (status === 'start' || status === 'restart') {
		return '–û–•–û–¢–ê –ù–ê –õ–û–•–ê';
	} else {
		return status || '–ù–ï–ò–ó–í–ï–°–¢–ù–û';
	}
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
function updateStatus() {
	fetch('/status')
		.then(response => {
			if (response.ok) {
				return response.json();
			} else {
				throw new Error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ' + response.status);
			}
		})
		.then(data => {
			const statusElement = document.getElementById('status-value');
			const timeElement = document.getElementById('status-time');
			
			if (statusElement) {
				statusElement.textContent = formatStatus(data.status);
			}
			
			if (timeElement && data.updatedAt) {
				// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è (–¥–æ–±–∞–≤–ª—è–µ–º 8 —á–∞—Å–æ–≤ –¥–ª—è UTC+8)
				const date = new Date(data.updatedAt);
				date.setHours(date.getHours() + 8);
				const formattedTime = date.toLocaleString('ru-RU', {
					day: '2-digit',
					month: '2-digit',
					year: 'numeric',
					hour: '2-digit',
					minute: '2-digit',
					second: '2-digit'
				});
				timeElement.textContent = `(${formattedTime})`;
			}
		})
		.catch(error => {
			console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
		});
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
setInterval(updateStatus, 2000);

// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
	updateStatus();
});
</script>
</body>
</html> 